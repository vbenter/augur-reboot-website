import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BVOCwoKb.js";import{c as w}from"./utils.CBfrqCZ4.js";import{r as C}from"./index.Bv2DO4vj.js";import{$ as y,U as N}from"./animationStore.DYtN9AJJ.js";function F(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const E=r.createContext(void 0),_=({children:t,updateInterval:u=5*60*1e3})=>{const[o]=r.useState(()=>({timestamp:new Date().toISOString(),blockNumber:0,riskLevel:"unknown",riskPercentage:0,metrics:{largestDisputeBond:0,forkThresholdPercent:0,activeDisputes:0,disputeDetails:[]},nextUpdate:new Date(Date.now()+36e5).toISOString(),calculation:{method:"Static fallback",forkThreshold:275e3}})),[a,l]=r.useState(null),[m,c]=r.useState(!1),[n,s]=r.useState(),[p,d]=r.useState(!1),x=r.useCallback(async()=>{try{c(!0),s(void 0);const i="/",k=i.endsWith("/")?`${i}data/fork-risk.json`:`${i}/data/fork-risk.json`,j=await fetch(k);if(!j.ok)throw new Error(`Failed to load fork risk data: ${j.status}`);const R=await j.json();l(R)}catch(i){console.error("Error loading fork risk data:",i),s(i instanceof Error?i.message:"Failed to load data"),l(o)}finally{c(!1)}},[o]);r.useEffect(()=>{d(!0)},[]),r.useEffect(()=>{if(p){x();const i=setInterval(x,u);return()=>clearInterval(i)}},[x,u,p,o]);const f=i=>({percentage:i.riskPercentage,repStaked:i.metrics.largestDisputeBond,activeDisputes:i.metrics.activeDisputes}),g=i=>{let k;switch(i.riskLevel){case"normal":k="Normal";break;case"low":k="Low";break;case"moderate":k="Moderate";break;case"high":k="High";break;case"elevated":k="Elevated";break;default:k="Normal"}return{level:k}},b=i=>{try{return new Date(i.timestamp).toLocaleString()}catch{return"Unknown"}},v=a||o,L=r.useCallback(i=>{l(i)},[]),M={gaugeData:f(v),riskLevel:g(v),lastUpdated:b(v),isLoading:m,error:n||v.error,rawData:v,setData:L,refetch:x};return e.jsx(E.Provider,{value:M,children:t})},D=()=>{const t=r.useContext(E);if(!t)throw new Error("useForkData must be used within a ForkDataProvider");return t};var h=(t=>(t.NO_DISPUTES="no_disputes",t.LOW_RISK="low_risk",t.MODERATE_RISK="moderate_risk",t.HIGH_RISK="high_risk",t.ELEVATED_RISK="elevated_risk",t))(h||{});const I=r.createContext(void 0),U=({children:t})=>{const[u,o]=r.useState(!1),{setData:a}=D(),l=!1,m=r.useCallback(d=>{},[a,l]),c=r.useCallback(d=>{},[a,l]),n=r.useCallback(d=>{},[a,l]),s=r.useCallback(async()=>{try{const d="/",x=d.endsWith("/")?`${d}data/fork-risk.json`:`${d}/data/fork-risk.json`,f=await fetch(x);if(!f.ok)throw new Error(`Failed to load live data: ${f.status}`);const g=await f.json();a(g),o(!1)}catch(d){console.error("Error loading live fork risk data:",d),o(!1)}},[a]),p={isDemo:u,isDemoAvailable:l,generateRisk:m,generateScenario:c,setDemoData:n,resetToLive:s};return e.jsx(I.Provider,{value:p,children:t})},O=()=>{const t=r.useContext(I);if(!t)throw new Error("useForkMock must be used within a ForkMockProvider");return t},A=({percentage:t})=>{const u=s=>s===0?0:s<=10?0+s/10*25:s<=25?25+(s-10)/15*25:s<=75?50+(s-25)/50*40:Math.min(100,90+(s-75)/25*10),o=s=>{const p=u(s),d=Math.PI-p/100*Math.PI,x=200,f=200,g=120,b=x+g*Math.cos(d),v=f-g*Math.sin(d);return`M 80 200 A 120 120 0 0 1 ${b} ${v}`},a=s=>s===0?"NORMAL":s<10?"LOW":s<25?"MODERATE":s<75?"HIGH":"ELEVATED",l=s=>s<10?"var(--color-green-400)":s<25?"var(--color-yellow-400)":s<75?"var(--color-orange-400)":"var(--color-red-500)",c=(s=>{const p=u(s),d=Math.PI-p/100*Math.PI,x=200,f=200,g=100;return{x:x+g*Math.cos(d),y:f-g*Math.sin(d)}})(t),n=l(t);return e.jsxs("div",{className:w("relative mb-2 flex flex-col items-center"),children:[e.jsxs("svg",{className:"max-w-[180px] w-full",viewBox:"60 60 280 160",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"forkMeterGradient",x1:"80",y1:"200",x2:"320",y2:"200",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0%",style:{stopColor:"var(--color-green-400)"}}),e.jsx("stop",{offset:"35%",style:{stopColor:"var(--color-green-500)"}}),e.jsx("stop",{offset:"55%",style:{stopColor:"var(--color-yellow-400)"}}),e.jsx("stop",{offset:"80%",style:{stopColor:"var(--color-orange-400)"}}),e.jsx("stop",{offset:"100%",style:{stopColor:"var(--color-red-500)"}})]})}),e.jsx("path",{d:"M 80 200 A 120 120 0 0 1 320 200",fill:"none",stroke:"var(--color-green-800)",strokeWidth:"12",strokeLinecap:"round",opacity:"0.3"}),e.jsx("path",{d:o(t),fill:"none",stroke:"url(#forkMeterGradient)",strokeWidth:"12",strokeLinecap:"round",className:"fx-glow"}),e.jsxs("g",{style:{transition:"all 0.3s ease-in-out"},children:[e.jsx("line",{x1:"200",y1:"200",x2:c.x+2,y2:c.y+2,stroke:"rgba(0, 0, 0, 0.3)",strokeWidth:"4",strokeLinecap:"round"}),e.jsx("line",{x1:"200",y1:"200",x2:c.x,y2:c.y,stroke:n,strokeWidth:"4",strokeLinecap:"round",style:{filter:`drop-shadow(0 0 6px ${n})`}})]}),e.jsx("circle",{cx:"200",cy:"200",r:"8",fill:n,style:{filter:`drop-shadow(0 0 6px ${n})`}}),e.jsx("text",{x:"200",y:"165",textAnchor:"middle",fill:l(t),fontSize:"2.15rem",fontWeight:"bold",className:w("fx-glow-sm",`fx-glow-[${l(t)}]`),children:a(t)})]}),e.jsx("div",{className:"text-sm uppercase tracking-[0.5em] font-light text-muted-foreground",children:"FORK PRESSURE"})]})},V=({riskLevel:t,repStaked:u,activeDisputes:o})=>{const{rawData:a}=D(),l=n=>n.toLocaleString(),m=a.metrics.largestDisputeBond===0,c=a.metrics.disputeDetails?.length>0?a.metrics.disputeDetails.reduce((n,s)=>s.disputeBondSize>n.disputeBondSize?s:n):null;return e.jsx("div",{className:"w-full mb-1",children:m?e.jsx("div",{className:"uppercase font-light text-green-400 tracking-[0.1em] fx-glow",children:"System steady - No market disputes"}):e.jsxs("div",{className:"grid md:grid-cols-[8rem_8rem_8rem] md:place-content-center md:gap-y-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"FORK RISK"}),e.jsxs("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:[a.metrics.forkThresholdPercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-center md:border-x md:border-muted-foreground/40",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"DISPUTE BOND"}),e.jsxs("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:[l(a.metrics.largestDisputeBond)," REP"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"DISPUTE ROUND"}),e.jsx("div",{className:"uppercase font-light text-primary tracking-[0.1em] fx-glow",children:c?.disputeRound||1})]}),c&&e.jsxs("div",{className:"text-center md:col-span-full",children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.1em] font-light text-muted-foreground",children:"MARKET IN DISPUTE"}),e.jsx("div",{className:"uppercase font-light text-primary tracking-[0.1em] truncate mx-auto fx-glow",style:{maxWidth:"calc(100vw - 2rem)"},children:c.marketId})]})]})})};var P=C();const S=F(P),K=()=>{const{isDemo:t,isDemoAvailable:u,generateScenario:o,resetToLive:a}=O(),[l,m]=r.useState(!1);return u?(r.useEffect(()=>{const c=n=>{n.key==="F2"&&(n.preventDefault(),m(s=>!s))};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[]),l?S.createPortal(e.jsxs("div",{className:"fixed top-4 left-4 z-50 bg-background/95 border border-primary/30 p-4 rounded text-sm max-w-xs",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-primary font-bold",children:"Demo Controls"}),e.jsx("button",{onClick:()=>m(!1),className:"text-muted-foreground hover:text-primary",children:"Ã—"})]}),t&&e.jsxs("div",{className:"mb-3 p-2 bg-orange-900/20 border border-orange-500/30 rounded",children:[e.jsx("div",{className:"text-orange-400 text-xs font-bold mb-1",children:"DEMO MODE ACTIVE"}),e.jsx("button",{onClick:a,className:"text-xs bg-primary/20 hover:bg-primary/30 px-2 py-1 rounded",children:"Return to Live Data"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Generate Scenarios:"}),e.jsx("button",{onClick:()=>o(h.NO_DISPUTES),className:"block w-full text-left text-xs bg-green-900/20 hover:bg-green-900/30 px-2 py-1 rounded",children:"No Disputes (Steady)"}),e.jsx("button",{onClick:()=>o(h.LOW_RISK),className:"block w-full text-left text-xs bg-yellow-900/20 hover:bg-yellow-900/30 px-2 py-1 rounded",children:"Low Risk (1-10%)"}),e.jsx("button",{onClick:()=>o(h.MODERATE_RISK),className:"block w-full text-left text-xs bg-orange-900/20 hover:bg-orange-900/30 px-2 py-1 rounded",children:"Moderate Risk (10-25%)"}),e.jsx("button",{onClick:()=>o(h.HIGH_RISK),className:"block w-full text-left text-xs bg-red-900/20 hover:bg-red-900/30 px-2 py-1 rounded",children:"High Risk (25-75%)"}),e.jsx("button",{onClick:()=>o(h.ELEVATED_RISK),className:"block w-full text-left text-xs bg-red-800/30 hover:bg-red-800/40 px-2 py-1 rounded animate-pulse",children:"Elevated Risk (75%+)"})]}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Demo data shows different dispute bond scenarios for testing UI behavior."})]}),document.body):S.createPortal(e.jsx("div",{className:"fixed top-4 left-4 z-50 text-xs text-muted-foreground bg-background/90 px-2 py-1 rounded",children:"DEV: F2 for demo"}),document.body)):null},$=({animated:t=!0})=>{const[u,o]=r.useState(!1),{gaugeData:a,riskLevel:l,lastUpdated:m,isLoading:c,error:n}=D();return r.useEffect(()=>{const s=y.subscribe(x=>{const f=x.uiState===N.MAIN_CONTENT;o(f)}),d=y.get().uiState===N.MAIN_CONTENT;return o(d),s},[]),u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full text-center py-8",children:[c&&e.jsx("div",{className:"mb-4 text-muted-foreground",children:"Loading fork risk data..."}),n&&e.jsxs("div",{className:"mb-4 text-orange-400",children:["Warning: ",n]}),e.jsx(A,{percentage:a.percentage}),e.jsx(V,{riskLevel:l,repStaked:a.repStaked,activeDisputes:a.activeDisputes}),e.jsxs("div",{className:"text-sm font-light tracking-[0.05em] uppercase text-muted-foreground",children:["Last updated: ",e.jsx("span",{children:m})]})]}),e.jsx(K,{})]}):null},B=({animated:t=!0})=>e.jsx(_,{children:e.jsx(U,{children:e.jsx($,{animated:t})})});export{B as default};
